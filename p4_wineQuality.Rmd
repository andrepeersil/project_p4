---
output:
  pdf_document: default
  html_document: default
---
ANÁLISE DE VINHOS TINTOS por ANDRÉ PEREIRA
========================================================

O objetivo deste estudo é descobrir quais atributos mais contribuem para a qualidade do vinho.Vamos estudar as relações entre os atributos visando saber quais combinações devem gerar notas mais altas para o atributo de qualidade.

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Carregue aqui todos os pacotes utilizados 
# na sua análise realizada neste arquivo fonte.

# Note que o parâmetro "echo" foi definido como FALSE neste código.
# Isso previne que o código apresente resultados formatados em HTML.
# Você deve definir echo=FALSE para todos os blocos de código no seu arquivo.

library(ggplot2)
library(GGally)
library(scales)
#library(memisc)
#library(lattice)
#library(MASS)
library(gridExtra)
library(dplyr)
library(reshape2)
```

```{r echo=FALSE, Load_the_Data}
# Carregamento dos dados
wn <- read.csv('wineQualityReds.csv')
```

# Seção de Gráficos Univariados

Esse arquivo contém 1599 observações com 13 variáveis. Vamos primeiro ver os valores máximos, mínimos, médios e medianos para cada atributo.

## Names e Summary
```{r echo=FALSE, Univariate_Plots}
names(wn)
summary(wn)
summary(wn$quality)

```

## Distribuição do atributo Qualidade

Agora vamos ver qual a distribuição de cada nota.
```{r echo=FALSE, Univariate_Plots}

ggplot(data = wn, aes(x = quality))+
  geom_histogram(color = 'black', fill = 'red',binwidth = 1) + 
  scale_x_continuous(breaks = seq(3,8,1)) +
  xlab('Qualidade') +
  ylab('Quantidade') +
  ggtitle('DISTRIBUIÇÃO DA QUALIDADE') +
  theme(plot.title = element_text(size = 10, face = "bold", hjust = 0.5))

```

Podemos ver que a maior parte das notas se concentra ente 5 e 6.

## Seção de Gráficos Univariaveis 

Nesta seção iremos trabalhar com gráficos com apenas uma variável isolada e tentar descobrir alguma relação com a qualidade.

## Distribuição dos outros elementos químicos

Vamos começar fazendo uma distribuição de cada atribuito em relação a quantidade, para ter uma noção do tipo de distruição(Normal, cauda longa, etc.)

```{r echo=FALSE, Univariate_Plots}

p1 <- ggplot(data = wn, aes(x = residual.sugar)) +
  geom_histogram(color = 'black', fill = 'red',binwidth = .5) + 
  scale_x_continuous(breaks = seq(0,16,5)) +
  xlab('Resíduo de açúcar') +
  ylab('Qtde') +
  ggtitle('Distribuição do Resíduo de açúcar') +
  theme(plot.title = element_text(size = 10, face = "bold", hjust = 0.5),
    axis.title=element_text(size=8),
    axis.text=element_text(size=7))

p2 <- ggplot(data = wn, aes(x = fixed.acidity)) +
  geom_histogram(color = 'black', fill = 'red',binwidth = .5) + 
  scale_x_continuous(breaks = seq(4,16,5)) +
  xlab('Acidez Fixa') +
  ylab('Qtde') +
  ggtitle('Distribuição da Acidez Fixa') +
  theme(plot.title = element_text(size = 10, face = "bold", hjust = 0.5),
    axis.title=element_text(size=8),
    axis.text=element_text(size=7))

p3 <- ggplot(data = wn, aes(x = volatile.acidity)) +
  geom_histogram(color = 'black', fill = 'red',binwidth = .05) + 
  scale_x_continuous(breaks = seq(0,1.6,.5)) +
  xlab('Acidez Volátil') +
  ylab('Qtde') +
  ggtitle('Distribuição da Acidez Volátil') +
  theme(plot.title = element_text(size = 10, face = "bold", hjust = 0.5),
    axis.title=element_text(size=8),
    axis.text=element_text(size=7))

p4 <- ggplot(data = wn, aes(x = citric.acid)) +
  geom_histogram(color = 'black', fill = 'red',binwidth = .05) + 
  scale_x_continuous(breaks = seq(0,1)) +
  xlab('Ácido Cítrico') +
  ylab('Qtde') +
  ggtitle('Distribuição do Ácido Cítrico') +
  theme(plot.title = element_text(size = 10, face = "bold", hjust = 0.5),
    axis.title=element_text(size=8),
    axis.text=element_text(size=7))

p5 <- ggplot(data = wn, aes(x = chlorides)) +
  geom_histogram(color = 'black', fill = 'red',binwidth = .05) + 
  scale_x_continuous(breaks = seq(0,.7, 0.2)) +
  xlab('Cloretos') +
  ylab('Qtde') +
  ggtitle('Distribuição de Cloretos') +
  theme(plot.title = element_text(size = 10, face = "bold", hjust = 0.5),
    axis.title=element_text(size=8),
    axis.text=element_text(size=7))

p6 <- ggplot(data = wn, aes(x = free.sulfur.dioxide)) +
  geom_histogram(color = 'black', fill = 'red',binwidth = 4) + 
  scale_x_continuous(breaks = seq(0,72,20)) +
  xlab('Dióxido de enxofre livre') +
  ylab('Qtde') +
  ggtitle('Distribuição de Dióxido de enxofre livre') +
  theme(plot.title = element_text(size = 10, face = "bold", hjust = 0.5),
    axis.title=element_text(size=8),
    axis.text=element_text(size=7))

p7 <- ggplot(data = wn, aes(x = total.sulfur.dioxide)) +
  geom_histogram(color = 'black', fill = 'red',binwidth = 10) + 
  scale_x_continuous(breaks = seq(0,289,50)) +
  xlab('Dióxido de enxofre total') +
  ylab('Qtde') +
  ggtitle('Distribuição de Dióxido de enxofre total') +
  theme(plot.title = element_text(size = 10, face = "bold", hjust = 0.5),
    axis.title=element_text(size=8),
    axis.text=element_text(size=7))

p8 <- ggplot(data = wn, aes(x = density)) +
  geom_histogram(color = 'black', fill = 'red',binwidth = .0005) + 
  scale_x_continuous(breaks = seq(0.0099, 1.0037)) +
  xlab('Densidade') +
  ylab('Qtde') +
  ggtitle('Distribuição da Densidade') +
  theme(plot.title = element_text(size = 10, face = "bold", hjust = 0.5),
    axis.title=element_text(size=8),
    axis.text=element_text(size=7))


p9 <- ggplot(data = wn, aes(x = pH)) +
  geom_histogram(color = 'black', fill = 'red',binwidth = .1) + 
  scale_x_continuous(breaks = seq(2,4.5,.5)) +
  xlab('pH') +
  ylab('Qtde') +
  ggtitle('Distribuição do pH') +
  theme(plot.title = element_text(size = 10, face = "bold", hjust = 0.5),
    axis.title=element_text(size=8),
    axis.text=element_text(size=7))

p10 <- ggplot(data = wn, aes(x = sulphates)) +
  geom_histogram(color = 'black', fill = 'red',binwidth = .05) + 
  scale_x_continuous(breaks = seq(0.33,2,.5)) +
  xlab('Sulfatos') +
  ylab('Qtde') +
  ggtitle('Distribuição dos sulfatos') +
  theme(plot.title = element_text(size = 10, face = "bold", hjust = 0.5),
      axis.title=element_text(size=8),
      axis.text=element_text(size=7))

p11 <- ggplot(data = wn, aes(x = alcohol)) +
  geom_histogram(color = 'black', fill = 'red',binwidth = .5) + 
  scale_x_continuous(breaks = seq(8,16,2)) +
  xlab('Álcool') +
  ylab('Qtde') +
  ggtitle('Distribuição da Álcool') +
  theme(plot.title = element_text(size = 10, face = "bold", hjust = 0.5),
        axis.title=element_text(size=8),
        axis.text=element_text(size=7))

grid.arrange(p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11, ncol = 3)

```


## Calculando correlações

Como nosso objetivo é saber atráves desses dados é saber qual elemento químico mais influencia na qualidade do vinho, vamos calcular correlações entre os atributos, para ver o que podemos tirar disso.

```{r echo=FALSE, Outliers}
ggpairs(wn,
        colour = "cyl",
        upper = list(continuous = wrap("cor", size=2)))
```



## Analisando as correlações

```{r echo=FALSE, Outliers}
cor.test(wn$quality, wn$fixed.acidity, method = 'pearson')
cor.test(wn$quality, wn$volatile.acidity, method = 'pearson')
cor.test(wn$quality, wn$citric.acid, method = 'pearson')
cor.test(wn$quality, wn$residual.sugar, method = 'pearson')
cor.test(wn$quality, wn$chlorides, method = 'pearson')
cor.test(wn$quality, wn$free.sulfur.dioxide, method = 'pearson')
cor.test(wn$quality, wn$total.sulfur.dioxide, method = 'pearson')
cor.test(wn$quality, wn$density, method = 'pearson')
cor.test(wn$quality, wn$pH, method = 'pearson')
cor.test(wn$quality, wn$sulphates, method = 'pearson')
cor.test(wn$quality, wn$alcohol, method = 'pearson')

```

Com esses valores temos um bom ponto de partida para nossa análise, podemos ver que as maiores correlações com o atributo qualidade são:

Alcool : 0.476
Acidez Volátil : -0.390
Sulfato : 0.251


Apartir de agora vamos focar nesses 3 atributos, tentando desvendar suas relações com a qualidade do vinho

## Outliers

Antes de iniciar novas análises, vamos remover os outliers desses 3 atributos, visando retirar os pontos que podem atrapalhar as análises.

Vamos novamente sumarizar para ver a diferença de valores com a primeira vez que utilizamos o sumary().

## Rode apenas uma vez!
```{r echo=FALSE, Outliers}
outliers_alcool <- boxplot(wn$alcohol, plot=FALSE)$out
wn <- wn[-which(wn$alcohol %in% outliers_alcool),]

outliers_sulphates <- boxplot(wn$sulphates, plot=FALSE)$out
wn <- wn[-which(wn$sulphates %in% outliers_sulphates),]

outliers_volacid <- boxplot(wn$volatile.acidity, plot=FALSE)$out
wn <- wn[-which(wn$volatile.acidity %in% outliers_volacid),]

summary(wn)
```



# Análise Univariada

### Qual é a estrutura do conjunto de dados?

Distribuição Normal:Densidade, pH, Acidez volátil, Acidez Fixa.

Cauda longa: Resíduo de açúcar, Cloretos, 

Assimétrico a esquerda: Dióxido de Enxofre Livre e Total, Sulfatos


### Quais são os principais atributos de interesse deste conjunto de dados?
De acordo com os valores de correlação que foram encontrados, o atributo álcool é o que mais influencia a qualidade do vinho.

### Quais outros atributos você acha que podem lhe auxiliar na investigação destes atributos de interesse?
Acho que a acidez volátil, ácool e sulfatos podem ter grande influência, devido a alto valor de correlação, e esses serão os atributos que irei focar.

### Você criou novas variáveis a partir dos atributos existentes no conjunto de dados?
Criei a variável para tirar os outliers do álcool, acidez volátil e sulfatos.

### Dos atributos investigados, distribuições incomuns foram encontradas? Você aplicou operações nos dados para limpá-los, ajustá-los ou mudar a forma dos dados? Se sim, por que?
O resíduo e açucar e Cloretos apresentaram distribuição de cauda longa.


# Seção de Gráficos Bivariados

Agora iremos trabalhar com gráficos que trabalham com duas variáveis, queremos aqui ver se encontramos relação fortes entre a qualidade e os 3 atributos que escolhemos.

Vamos começar com um gráfico de pontos, olhando a distribuição entre o atributo e a qualidade, e vamos inserir uma linha linear.

```{r echo=FALSE, Bivariate_Plots}
p1 <- ggplot(data = wn, aes(x = alcohol, y = quality)) +
  geom_point(size = 3,alpha = 1/8) +
  geom_smooth(method = lm) +
  ggtitle('Álcool x Qualidade') +
theme(plot.title = element_text(size = 10, face = "bold", hjust = 0.5))

p2 <- ggplot(data = wn, aes(x = volatile.acidity, y = quality)) +
  geom_point(size = 3,alpha = 1/8) +
  geom_smooth(method = lm) +
  ggtitle('Ácidez Volátil x Qualidade') +
theme(plot.title = element_text(size = 10, face = "bold", hjust = 0.5))

p3 <- ggplot(data = wn, aes(x = sulphates, y = quality)) +
  geom_point(size = 3,alpha = 1/8) +
  geom_smooth(method = lm) +
  ggtitle('Sulpatos x Qualidade') +
theme(plot.title = element_text(size = 10, face = "bold", hjust = 0.5))

grid.arrange(p1,p2,p3, ncol = 2)
```

Apesar de ser possível vermos algumas relações, vamos tetnar trabalhar com boxplots, que devem nos dar uma melhor visualização.

# Qualidade categorizado

Vamos criar uma nova variável para separar por categorias, para poder criar boxplots.
```{r echo=FALSE}
wn$labels<-cut(wn$quality, 
                          c(2.5,3.5,4.5,5.5,6.5,7.5,8.5),
                          labels=c('3','4','5','6','7','8'))
head(wn$labels)
```

# Boxplots com os principais atributos

Os três principais atributos, vamos criar box plots relacionando as notas com os valores de cada atributo, para vermos se encontramos algum padão com as alterações dos valores.

```{r echo=FALSE}
p1 <- ggplot(wn, 
       aes(x=labels, y=alcohol,fill=labels)) + 
       geom_boxplot()

p2 <- ggplot(wn, 
       aes(x=labels, y= volatile.acidity,fill=labels)) + 
       geom_boxplot()

p3 <- ggplot(wn, 
       aes(x=labels, y=sulphates,fill=labels)) + 
       geom_boxplot()

grid.arrange(p1,p2,p3, ncol = 2)
```

COm esses gráficos, podemos ver um certo padrão, principalmente na acidez volátil, onde a qualidade é inversamente proporcional ao valor desse atributo.

# Driagramas de desidade.

Vamos tentar também ver esses dados pela densidade, relaionando aqualidade com o atributo. Vamos comerçar fazendo com o atributo  "Alcool".

```{r echo=FALSE}

ggplot(wn, aes(x=alcohol, fill=labels)) +
      geom_density(aes(y=..density..),binwidth=.5, 
                  alpha=.5, position="identity")
```

# Criação de categorias para as notas

No primeiro plot, dada a quantidade alta de notas o gráfica se torna confuso, e ficaria mais visível as relações se agrupassemos as notas em menos categorias. Para isso vamos dividir as 6 notas em apenas 3 notas, sendo elas "Baixa", "Média", "Alta".

```{r echo=FALSE}


wn$nota<-cut(wn$quality, c(2.5,4.5,6.5,8.5),
                   labels=c('Baixa','Média','Alta'))
```

# Diagras de densidade com menos categorias para qualidade

```{r echo=FALSE}
p1 <- ggplot(wn, aes(x=alcohol, fill=nota)) +
      geom_density(aes(y=..density..),binwidth=.5, 
                  alpha=.5, position="identity")

p2 <- ggplot(wn, aes(x=volatile.acidity, fill=nota)) +
      geom_density(aes(y=..density..),binwidth=.5, 
                  alpha=.5, position="identity")

p3 <- ggplot(wn, aes(x=sulphates, fill=nota)) +
      geom_density(aes(y=..density..),binwidth=.5, 
                  alpha=.5, position="identity")

grid.arrange(p1,p2, p3, ncol = 1)
```

Com esses três ultimos gráficos podemos ter uma norção muito boa onde se concetram as notas mais altas apra cada atributo.

# Análise Bivariada

### Discuta sobre alguns dos relacionamentos observados nesta parte da investigação. Como os atributos de interesse variaram no conjunto de dados?

Podemos ver que como imaginado, os 3 atributos deram uma noção muito boa de onde se concetram as notas mais altas, no álcool as notas mais altas estão com o valor 12, enquanto na acidez volátil estão no valor .3, e já com os sulfatos estão próximos ao .78.


### Você observou algum relacionamento interessante entre os outros atributos (os que não são de interesse)?

Não.

### Qual foi o relacionamento mais forte encontrado?
O relaciomaneto mais forte foi com o Alcool.


# Seção de Gráficos Multivariados

Nestes 2 primeiros gráficos vamos verificar a relação do álcool, que já vimos ser o principal atributo relacionado a qualidade, mas adicionando uma nova variável a cada gráfico.

```{r echo=FALSE, Multivariate_Plots}

ggplot(wn, aes(x=alcohol,y=volatile.acidity)) +
      geom_point(aes(shape=nota, color = nota, size = nota),alpha=1/4, size = 2)+
      xlab("Alcool") + ylab("Acidez Volátil") +
      ggtitle('Alcool x Acidez Volátil x Nota') + 
      theme(plot.title = element_text(size = 10, face = "bold", hjust = 0.5))

```

```{r echo=FALSE, Multivariate_Plots}

ggplot(wn, aes(x=alcohol,y=sulphates)) +
      geom_point(aes(shape=nota, color = nota, size = nota),alpha=1/4, size = 2)+
      xlab("Alcool") + ylab("Sulfatos") +
      ggtitle('Alcool x Sulfatos x Nota') + 
      theme(plot.title = element_text(size = 10, face = "bold", hjust = 0.5))

```



Com essas relações podemos levantar novas suposições, é visível que no primeiro gráfico as notas mais altas se concentram em valores menores de acidez volátil e valores eledos de álcool, já no segundo, a concentração de sulfato com as notas altas ficou entre .6 e .8.

Agora podemos realizar esses mesmos estudos, mas utilizando as duas variáveis como princupal, vamos começar pela acidez volátil

```{r echo=FALSE, Multivariate_Plots}

ggplot(wn, aes(x=volatile.acidity,y=sulphates)) +
      geom_point(aes(shape=nota, color = nota, size = nota),alpha=1/4, size = 2)+
      xlab("Acidez Volátil") + ylab("Sulfatos") +
      ggtitle('Acidez Volátil x Sulfatos x Nota') + 
      theme(plot.title = element_text(size = 10, face = "bold", hjust = 0.5))


```

# Anáise Multivariada

### Discuta sobre os relacionamentos observados nesta parte da investigação. Quais atributos que fortaleceram os demais na observação das variáveis de interesse?

Gráfico 1: Esse foi o gráfico que menos demonstrou relacionamento entre as variáveis estudadas,elas não estão visivelmente separadas, no entando podemos ver que os pontos azuis, referentes a qualidade mais alta, está concentrada no canto inefrior direto, onde os valores de álcool são altos e os de acidez volático ssão mais baixos.

Gráfico 2: Esse gráfico também está bastante difuso, é possível ver uma certa prevalência com valores altos de álcool e valores altos de sulfato.

Gráfico 3: Esse é o gráfico com a melhor visualização das notas, onde os valores dados como "Alto" estão concetrados entre 0.25 e 0,50 para a acidez volátil, e entre 0.6 e 0.8 para o Sulfato.


### Interações surpreendentes e/ou interessantes foram encontradas entre os atributos?

A interação entre a acidez voláti e o sulfato se demonstrou com um resultado interessante.


------

# Gráficos Finais e Sumário

### Primeiro Gráfico
```{r echo=FALSE, Plot_One}
ggplot(data = wn, aes(x = quality))+
  geom_histogram(color = 'black', fill = 'red',binwidth = 1) + 
  scale_x_continuous(breaks = seq(3,8,1)) +
  xlab('Qualidade') +
  ylab('Quantidade') +
  ggtitle('DISTRIBUIÇÃO DA QUALIDADE') +
  theme(plot.title = element_text(size = 10, face = "bold", hjust = 0.5))
```

### Descrição do Primeiro Gráfico

O primeiro gráfico se limita a contar quantos vinhos foram classificados com cada nota, nos dando uma noção de onde se concentram a maior parte das notas.

### Segundo Gráfico
```{r echo=FALSE, Plot_Two}

p1 <- ggplot(wn, aes(x=alcohol, fill=nota)) +
      geom_density(aes(y=..density..),binwidth=.5, 
                  alpha=.5, position="identity")

p2 <- ggplot(wn, aes(x=volatile.acidity, fill=nota)) +
      geom_density(aes(y=..density..),binwidth=.5, 
                  alpha=.5, position="identity")

p3 <- ggplot(wn, aes(x=sulphates, fill=nota)) +
      geom_density(aes(y=..density..),binwidth=.5, 
                  alpha=.5, position="identity")

grid.arrange(p1,p2, p3, ncol = 1)

```

### Descrição do Segundo Gráfico

NEste gráfico estudamos as desidades referentes a quantidade de cada atributo, em comparação com a nota que lhe foi atribuída, onde é possível ver onde existe concentração das maiores notas.

### Terceiro Gráfico
```{r echo=FALSE, Plot_Three}


p1 <- ggplot(wn, aes(x=alcohol,y=volatile.acidity)) +
      geom_point(aes(shape=nota, color = nota, size = nota),alpha=1/4, size = 2)+
      xlab("Alcool") + ylab("Acidez Volátil") +
      ggtitle('Alcool x Acidez Volátil x Nota') + 
      theme(plot.title = element_text(size = 10, face = "bold", hjust = 0.5))

p2 <- ggplot(wn, aes(x=alcohol,y=sulphates)) +
      geom_point(aes(shape=nota, color = nota, size = nota),alpha=1/4, size = 2)+
      xlab("Alcool") + ylab("Sulfatos") +
      ggtitle('Alcool x Sulfatos x Nota') + 
      theme(plot.title = element_text(size = 10, face = "bold", hjust = 0.5))

p3 <- ggplot(wn, aes(x=volatile.acidity,y=sulphates)) +
      geom_point(aes(shape=nota, color = nota, size = nota),alpha=1/4, size = 2)+
      xlab("Acidez Volátil") + ylab("Sulfatos") +
      ggtitle('Acidez Volátil x Sulfatos x Nota') + 
      theme(plot.title = element_text(size = 10, face = "bold", hjust = 0.5))

grid.arrange(p1,p2,p3, ncol = 2)

```

### Descrição do Terceiro Gráfico

Nestes gráficos buscamos visualizar uma correção entre dois atributos, para buscar onde os pontos referentes as maireos notas vão estar com maior concentração;

------

# Reflexão


